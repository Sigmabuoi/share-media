<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“¸ Chia sáº» áº¢nh & Video</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>ğŸ“¸ Chia sáº» áº¢nh & Video</h1>
        <p>Táº£i lÃªn vÃ  chia sáº» khoáº£nh kháº¯c cá»§a báº¡n!</p>
    </header>

    <main>
        <form id="uploadForm" action="upload.php" method="POST" enctype="multipart/form-data">
            <input type="file" id="media" name="media" accept="image/jpeg,image/png,image/gif,image/webp,video/mp4,video/webm,video/ogg">
            <button type="submit" id="uploadBtn">ğŸ“¤ Táº£i lÃªn</button>
        </form>

        <div id="notification" style="text-align: center; margin-bottom: 15px;"></div>

        <h2>ğŸ“· áº¢nh</h2>
        <div id="imageContainer" class="gallery"></div>

        <h2>ğŸ¥ Video</h2>
        <div id="videoContainer" class="gallery"></div>
    </main>

    <footer>
        <p>Made with â¤ï¸ by Duc</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const form = document.getElementById('uploadForm');
            const fileInput = document.getElementById('media');
            const uploadBtn = document.getElementById('uploadBtn');
            const imageContainer = document.getElementById('imageContainer');
            const videoContainer = document.getElementById('videoContainer');
            const statusMessage = document.getElementById('notification');

            // Load danh sÃ¡ch file
            function loadFiles() {
                fetch('list.php')
                    .then(res => {
                        if (!res.ok) throw new Error(`Lá»—i HTTP: ${res.status}`);
                        return res.json();
                    })
                    .then(files => {
                        imageContainer.innerHTML = '';
                        videoContainer.innerHTML = '';
                        files.forEach(file => {
                            if (file.type === 'image') {
                                const img = document.createElement('img');
                                img.src = file.url;
                                img.alt = 'áº¢nh chia sáº»';
                                img.classList.add('media-item');
                                imageContainer.appendChild(img);
                            } else if (file.type === 'video') {
                                const video = document.createElement('video');
                                video.src = file.url;
                                video.controls = true;
                                video.classList.add('media-item');
                                videoContainer.appendChild(video);
                            }
                        });
                    })
                    .catch(err => {
                        console.error('Lá»—i khi táº£i danh sÃ¡ch:', err);
                        statusMessage.textContent = 'âŒ Lá»—i khi táº£i danh sÃ¡ch!';
                        statusMessage.style.color = 'red';
                    });
            }

            // Xá»­ lÃ½ upload
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                if (!fileInput.files.length) {
                    statusMessage.textContent = 'âš ï¸ Vui lÃ²ng chá»n tá»‡p!';
                    statusMessage.style.color = 'orange';
                    return;
                }

                const formData = new FormData(form);
                uploadBtn.disabled = true;
                uploadBtn.textContent = 'Äang táº£i...';
                statusMessage.textContent = 'â³ Äang táº£i lÃªn...';
                statusMessage.style.color = 'blue';

                fetch('upload.php', { method: 'POST', body: formData })
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            statusMessage.textContent = 'âœ… Táº£i lÃªn thÃ nh cÃ´ng!';
                            statusMessage.style.color = 'green';
                            fileInput.value = '';
                            loadFiles();
                        } else {
                            throw new Error(data.error);
                        }
                    })
                    .catch(err => {
                        console.error('Lá»—i táº£i lÃªn:', err);
                        statusMessage.textContent = `âŒ ${err.message}`;
                        statusMessage.style.color = 'red';
                    })
                    .finally(() => {
                        uploadBtn.disabled = false;
                        uploadBtn.textContent = 'ğŸ“¤ Táº£i lÃªn';
                    });
            });

            // Load láº§n Ä‘áº§u
            loadFiles();
        });
    </script>
</body>
</html>